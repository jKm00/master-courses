---
author: Joakim
date: 06.05.24
---

# Exam 2013

## Task 2

### A - When to use threat modeling?

- Deduce security requirements from functional requirements (misuse cases)
- Analyze threats towards the system (attack trees and misuse cases)
- Risk analysis (attack trees)
- Plan security testing (attack trees)
- Map a system's attack surface (data flow diagrams)

### B - How does an XSS-attack work?

And XSS attack works by allowing an attacker to input some malicious code into the website that is then rendered making the code execute on a client. This can for example be done by posting a comment on a post. If the input is not validated, whenever the comment is rendered to a user, the code in the comment is executed. This is called a stored XSS as the comment is stored and everyone viewing the comment will have the malicious code executed on their client.

### C - What is a one-time pad?

_Dont think this is relevant but I know the answer_

A one-time pad is a ciphersuit where the key is a sequence of randomly chosen characters equal to the length of a message to send. The sequence is the key and is used with the message to calculate a cipertext by adding the number value of characters in the message with the number value of characters in the key and taking the modulo.

### D - What is the attack surface of a system?

The attack surface of a system describes all the possible areas where an attack can be performed.

_The attack surface of a system is an overview of any place an attacker can get access to, and launch an attack towards the system_

### E - What is the purpose of creting a risk-based test plan?

The purpose it to highlight risks in the system and rank them to make sure the business is spending their time and money as efficient as possible.

### F - What are the main pros and cons of manual code review vs code review with tool?

- Manual code review takes more time and is therefore more time consimuning making it more expensive.
- Code review tools will only detect pre-defined security issues where as manual can detect more underlying issues as well as code smells.
- Code review tools can give a good feedback on the overall state of the code with statistics.

## Task 3

### A - Create a password policy for the ticket ordering system

- Password need lower and upper case letters
- Password should contain at least one digit
- Password should contain at least one special character (!#$%&\_-)
- Password must be more than 8 characters

### B.1 - Storing the password

The password should be hashed together with a salt. The value of the hash and the salt should be stored in a database.

```js
function hashPassword(password: string) {
  const salt = randomSalt();
  const hashedPassword = hash(password + salt);
  db.save(hashedPassword, salt);
}
```

### B.2 - Perform password checks

Fetch the hashed password and the salt from the database. Take the password provided by the user and hash it together with the salft fetched from the database. The password is correct if the result of this hash is equal to the hash fetched from the database.

```js
function isValidPassword(password: string) {
  const { storedHashedPassword, salt } = fetchPasswordFromDb();

  const hashedPassword = hash(password + salt);

  return hashedPassowrd === storedHashedPassword;
}
```

### B.3 - Allow users to reset their password

Create a reset password token and send this via an email to the requesting user. The token should have an experation date and it should not be able to guess (can not use incremented values: 1, 2, ...). The user clicks the link in the email and is redirected to a form for resetting the password with the reset password token in the url. When the user sends the reset request to the server, check that the reset password token is the correct one and that it is still valid. If so, reset the password of the user with the provided value. Finally, send a verification email to the user that the password has been reset.

```js
function sendResetPasswordEmail(email: string) {
  const resetPasswordToken = generateRandomToken();

  const email = new Email()
    .to(email)
    .subject('Reset password')
    .body(`BASE_URL/reset-password?token=${resetPasswordToken}`)
    .send();
}

function resetPassword(email: string, newPassword: string, token: string) {
  if (!isValidResetPasswordToken(token)) {
    return new Response(401, 'Unauthorized');
  }

  db.update.user({
    where: {
      email,
    },
    data: {
      password: newPassword,
    },
  });

  const email = new Email()
    .to(email)
    .subeject('Password updated!')
    .body(
      'The password for your account has been updated. If this was not you, please log in and change your password and contact the support desk!'
    )
    .send();
}
```
